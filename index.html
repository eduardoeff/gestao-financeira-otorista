<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Gest√£o Financeira Inteligente</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="bg-gray-100">
  <div id="root"></div>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const firebaseConfig = {
      apiKey: "AIzaSyBjvoL-4ea23mDnuH6Cq65yXtWkKvj9EEU",
      authDomain: "gestao-motorista-4155f.firebaseapp.com",
      projectId: "gestao-motorista-4155f",
      storageBucket: "gestao-motorista-4155f.firebasestorage.app",
      messagingSenderId: "566057933394",
      appId: "1:566057933394:web:afafa56f71557758b11d8b"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }

    const auth = firebase.auth();
    const db = firebase.firestore();

    function App() {
      const [user, setUser] = useState(null);
      const [loading, setLoading] = useState(true);
      const [authMode, setAuthMode] = useState('login');
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [authError, setAuthError] = useState('');

      const [activeTab, setActiveTab] = useState('dashboard');
      const [dailyEarnings, setDailyEarnings] = useState([]);
      const [expenses, setExpenses] = useState([]);
      const [houseExpenses, setHouseExpenses] = useState([]);
      const [customPlatforms, setCustomPlatforms] = useState([]);

      const [showEarningModal, setShowEarningModal] = useState(false);
      const [showExpenseModal, setShowExpenseModal] = useState(false);
      const [showHouseModal, setShowHouseModal] = useState(false);

      const [filterPeriod, setFilterPeriod] = useState('month');

      const chartRef = useRef(null);
      const chartInstance = useRef(null);
      const barChartRef = useRef(null);
      const barChartInstance = useRef(null);

      const today = new Date().toISOString().split('T')[0];

      const defaultPlatforms = ['Uber', '99', 'InDrive'];

      const [earningForm, setEarningForm] = useState({
        date: today,
        platform: 'Uber',
        customPlatform: '',
        value: ''
      });

      const [expenseForm, setExpenseForm] = useState({
        date: today,
        category: 'Combust√≠vel',
        description: '',
        value: ''
      });

      const [houseForm, setHouseForm] = useState({
        date: today,
        category: 'Alimenta√ß√£o',
        description: '',
        value: ''
      });

      useEffect(() => {
        const unsubscribe = auth.onAuthStateChanged((currentUser) => {
          setUser(currentUser);
          setLoading(false);
        });
        return () => unsubscribe();
      }, []);

      useEffect(() => {
        if (!user) return;

        const unsubscribers = [];

        const earningsQuery = db
          .collection('dailyEarnings')
          .where('userId', '==', user.uid)
          .orderBy('date', 'desc');

        unsubscribers.push(earningsQuery.onSnapshot((snapshot) => {
          const data = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data(),
            value: parseFloat(doc.data().value) || 0
          }));
          setDailyEarnings(data);
        }));

        const expensesQuery = db
          .collection('expenses')
          .where('userId', '==', user.uid)
          .orderBy('date', 'desc');

        unsubscribers.push(expensesQuery.onSnapshot((snapshot) => {
          const data = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data(),
            value: parseFloat(doc.data().value) || 0
          }));
          setExpenses(data);
        }));

        const houseQuery = db
          .collection('houseExpenses')
          .where('userId', '==', user.uid)
          .orderBy('date', 'desc');

        unsubscribers.push(houseQuery.onSnapshot((snapshot) => {
          const data = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data(),
            value: parseFloat(doc.data().value) || 0
          }));
          setHouseExpenses(data);
        }));

        const platformsQuery = db
          .collection('customPlatforms')
          .where('userId', '==', user.uid);

        unsubscribers.push(platformsQuery.onSnapshot((snapshot) => {
          const data = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data()
          }));
          setCustomPlatforms(data);
        }));

        return () => {
          unsubscribers.forEach(unsub => unsub());
        };
      }, [user]);

      const handleAuth = async (e) => {
        e.preventDefault();
        setAuthError('');
        try {
          if (authMode === 'login') {
            await auth.signInWithEmailAndPassword(email, password);
          } else {
            await auth.createUserWithEmailAndPassword(email, password);
          }
        } catch (error) {
          if (error.code === 'auth/email-already-in-use') {
            setAuthError('Este e-mail j√° est√° cadastrado');
          } else if (error.code === 'auth/weak-password') {
            setAuthError('A senha deve ter pelo menos 6 caracteres');
          } else if (error.code === 'auth/invalid-email') {
            setAuthError('E-mail inv√°lido');
          } else if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
            setAuthError('E-mail ou senha incorretos');
          } else {
            setAuthError('Erro ao autenticar. Tente novamente.');
          }
        }
      };

      const handleLogout = async () => {
        await auth.signOut();
      };

      const addEarning = async () => {
        if (!earningForm.value || !user) {
          alert('Por favor, preencha o valor');
          return;
        }

        const finalPlatform = earningForm.platform === 'Outra'
          ? earningForm.customPlatform.trim()
          : earningForm.platform;

        if (!finalPlatform) {
          alert('Por favor, informe a plataforma');
          return;
        }

        try {
          if (earningForm.platform === 'Outra' && earningForm.customPlatform.trim()) {
            const platformExists = customPlatforms.some(p =>
              p.name.toLowerCase() === earningForm.customPlatform.trim().toLowerCase()
            );

            if (!platformExists) {
              await db.collection('customPlatforms').add({
                name: earningForm.customPlatform.trim(),
                userId: user.uid,
                createdAt: new Date().toISOString()
              });
            }
          }

          await db.collection('dailyEarnings').add({
            date: earningForm.date,
            platform: finalPlatform,
            value: parseFloat(earningForm.value) || 0,
            userId: user.uid,
            createdAt: new Date().toISOString()
          });

          setEarningForm({ date: today, platform: 'Uber', customPlatform: '', value: '' });
          setShowEarningModal(false);
        } catch (error) {
          console.error('Erro ao salvar ganho:', error);
          alert('Erro ao salvar. Verifique o console para mais detalhes.');
        }
      };

      const addExpense = async () => {
        if (!expenseForm.value || !user) return;
        try {
          await db.collection('expenses').add({
            ...expenseForm,
            value: parseFloat(expenseForm.value) || 0,
            userId: user.uid,
            createdAt: new Date().toISOString()
          });
          setExpenseForm({ date: today, category: 'Combust√≠vel', description: '', value: '' });
          setShowExpenseModal(false);
        } catch (error) {
          console.error('Erro ao salvar despesa:', error);
          alert('Erro ao salvar despesa.');
        }
      };

      const addHouseExpense = async () => {
        if (!houseForm.value || !user) return;
        try {
          await db.collection('houseExpenses').add({
            ...houseForm,
            value: parseFloat(houseForm.value) || 0,
            userId: user.uid,
            createdAt: new Date().toISOString()
          });
          setHouseForm({ date: today, category: 'Alimenta√ß√£o', description: '', value: '' });
          setShowHouseModal(false);
        } catch (error) {
          console.error('Erro ao salvar despesa casa:', error);
          alert('Erro ao salvar despesa.');
        }
      };

      const deleteEarning = async (id) => {
        if (confirm('Deseja realmente excluir este ganho?')) {
          await db.collection('dailyEarnings').doc(id).delete();
        }
      };

      const deleteExpense = async (id) => {
        if (confirm('Deseja realmente excluir esta despesa?')) {
          await db.collection('expenses').doc(id).delete();
        }
      };

      const deleteHouseExpense = async (id) => {
        if (confirm('Deseja realmente excluir esta despesa?')) {
          await db.collection('houseExpenses').doc(id).delete();
        }
      };

      const getFilteredData = (data) => {
        const now = new Date();
        return data.filter(item => {
          const itemDate = new Date(item.date);

          if (filterPeriod === 'week') {
            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            return itemDate >= weekAgo;
          }

          if (filterPeriod === 'month') {
            return (
              itemDate.getMonth() === now.getMonth() &&
              itemDate.getFullYear() === now.getFullYear()
            );
          }

          if (filterPeriod === 'lastMonth') {
            const prevMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);
            return (
              itemDate.getMonth() === prevMonth.getMonth() &&
              itemDate.getFullYear() === prevMonth.getFullYear()
            );
          }

          if (filterPeriod === 'year') {
            return itemDate.getFullYear() === now.getFullYear();
          }

          return true;
        });
      };

      const filteredEarnings = getFilteredData(dailyEarnings);
      const filteredExpenses = getFilteredData(expenses);
      const filteredHouseExpenses = getFilteredData(houseExpenses);

      const safeSum = (arr) =>
        arr.reduce((sum, item) => sum + (isNaN(item.value) ? 0 : item.value), 0);

      const totalEarnings = safeSum(filteredEarnings);
      const totalExpenses = safeSum(filteredExpenses);
      const totalHouseExpenses = safeSum(filteredHouseExpenses);
      const workProfit = totalEarnings - totalExpenses;
      const finalBalance = workProfit - totalHouseExpenses;

      const totalDays = filteredEarnings.length;
      const ticketMedio = totalDays > 0 ? totalEarnings / totalDays : 0;
      const custoPorDia = totalDays > 0 ? totalExpenses / totalDays : 0;
      const margemLucro = totalEarnings > 0 ? (workProfit / totalEarnings) * 100 : 0;

      const getCurrentMonthData = () => {
        const now = new Date();

        const currEarnings = dailyEarnings.filter(item => {
          const d = new Date(item.date);
          return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
        });

        const currExpenses = expenses.filter(item => {
          const d = new Date(item.date);
          return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
        });

        return {
          earnings: safeSum(currEarnings),
          expenses: safeSum(currExpenses),
          profit: safeSum(currEarnings) - safeSum(currExpenses)
        };
      };

      const getPreviousMonthData = () => {
        const now = new Date();
        const prevMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);

        const prevEarnings = dailyEarnings.filter(item => {
          const d = new Date(item.date);
          return d.getMonth() === prevMonth.getMonth() && d.getFullYear() === prevMonth.getFullYear();
        });

        const prevExpenses = expenses.filter(item => {
          const d = new Date(item.date);
          return d.getMonth() === prevMonth.getMonth() && d.getFullYear() === prevMonth.getFullYear();
        });

        return {
          earnings: safeSum(prevEarnings),
          expenses: safeSum(prevExpenses),
          profit: safeSum(prevEarnings) - safeSum(prevExpenses)
        };
      };

      const currentMonthData = getCurrentMonthData();
      const prevMonthData = getPreviousMonthData();

      const earningsChange = prevMonthData.earnings > 0
        ? ((currentMonthData.earnings - prevMonthData.earnings) / prevMonthData.earnings * 100).toFixed(1)
        : 0;
      const profitChange = prevMonthData.profit > 0
        ? ((currentMonthData.profit - prevMonthData.profit) / prevMonthData.profit * 100).toFixed(1)
        : 0;

      useEffect(() => {
        if (activeTab !== 'dashboard' || !chartRef.current) return;

        const ctx = chartRef.current.getContext('2d');

        if (chartInstance.current) {
          chartInstance.current.destroy();
        }

        const now = new Date();
        let datesArray = [];

        if (filterPeriod === 'month' || filterPeriod === 'lastMonth') {
          const baseMonth =
            filterPeriod === 'month'
              ? new Date(now.getFullYear(), now.getMonth(), 1)
              : new Date(now.getFullYear(), now.getMonth() - 1, 1);

          const year = baseMonth.getFullYear();
          const month = baseMonth.getMonth();
          const daysInMonth = new Date(year, month + 1, 0).getDate();

          for (let day = 1; day <= daysInMonth; day++) {
            const d = new Date(year, month, day);
            datesArray.push(d.toISOString().split('T')[0]);
          }
        } else {
          for (let i = 6; i >= 0; i--) {
            const d = new Date();
            d.setDate(d.getDate() - i);
            datesArray.push(d.toISOString().split('T')[0]);
          }
        }

        const earningsData = datesArray.map(date =>
          safeSum(dailyEarnings.filter(e => e.date === date))
        );

        const expensesData = datesArray.map(date =>
          safeSum(expenses.filter(e => e.date === date))
        );

        chartInstance.current = new Chart(ctx, {
          type: 'line',
          data: {
            labels: datesArray.map(d => {
              const date = new Date(d);
              return `${date.getDate()}/${date.getMonth() + 1}`;
            }),
            datasets: [
              {
                label: 'Ganhos',
                data: earningsData,
                borderColor: 'rgb(16, 185, 129)',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                tension: 0.4
              },
              {
                label: 'Despesas',
                data: expensesData,
                borderColor: 'rgb(251, 146, 60)',
                backgroundColor: 'rgba(251, 146, 60, 0.1)',
                tension: 0.4
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom'
              }
            },
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });

        return () => {
          if (chartInstance.current) {
            chartInstance.current.destroy();
          }
        };
      }, [activeTab, filterPeriod, dailyEarnings, expenses]);

      useEffect(() => {
        if (activeTab === 'dashboard' && barChartRef.current) {
          const ctx = barChartRef.current.getContext('2d');

          if (barChartInstance.current) {
            barChartInstance.current.destroy();
          }

          barChartInstance.current = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: ['Ticket M√©dio', 'Custo/Dia', 'Margem %'],
              datasets: [{
                label: 'Indicadores',
                data: [ticketMedio, custoPorDia, margemLucro],
                backgroundColor: [
                  'rgba(14, 165, 233, 0.8)',
                  'rgba(251, 146, 60, 0.8)',
                  'rgba(16, 185, 129, 0.8)'
                ]
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false
                }
              },
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });
        }

        return () => {
          if (barChartInstance.current) {
            barChartInstance.current.destroy();
          }
        };
      }, [activeTab, ticketMedio, custoPorDia, margemLucro]);

      const exportPDF = () => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        doc.setFontSize(18);
        doc.text('Relat√≥rio Financeiro', 20, 20);

        doc.setFontSize(12);
        doc.text(
          `Per√≠odo: ${
            filterPeriod === 'week'
              ? '√öltima Semana'
              : filterPeriod === 'month'
              ? 'M√™s Atual'
              : filterPeriod === 'lastMonth'
              ? 'M√™s Passado'
              : 'Ano Atual'
          }`,
          20,
          35
        );

        doc.text(`Receita Total: R$ ${totalEarnings.toFixed(2)}`, 20, 50);
        doc.text(`Despesas Trabalho: R$ ${totalExpenses.toFixed(2)}`, 20, 60);
        doc.text(`Lucro Trabalho: R$ ${workProfit.toFixed(2)}`, 20, 70);
        doc.text(`Despesas Casa: R$ ${totalHouseExpenses.toFixed(2)}`, 20, 80);
        doc.text(`Saldo Final: R$ ${finalBalance.toFixed(2)}`, 20, 90);

        doc.text(`Ticket M√©dio: R$ ${ticketMedio.toFixed(2)}`, 20, 105);
        doc.text(`Custo por Dia: R$ ${custoPorDia.toFixed(2)}`, 20, 115);
        doc.text(`Margem de Lucro: ${margemLucro.toFixed(1)}%`, 20, 125);

        doc.save('relatorio-financeiro.pdf');
      };

      if (loading) {
        return (
          <div className="min-h-screen flex items-center justify-center">
            <div className="text-center">
              <div className="text-4xl mb-2">‚è≥</div>
              <div className="text-gray-600">Carregando...</div>
            </div>
          </div>
        );
      }

      if (!user) {
        return (
          <div className="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-slate-900 via-slate-800 to-sky-700">
            <div className="w-full max-w-md">
              <div className="flex flex-col items-center mb-6">
                <div className="w-32 h-32 mb-4">
                  <img
                    src="https://i.ibb.co/Y4Jpys2S/download.png"
                    alt="Logo Gordinho do Comfort"
                    className="w-full h-full object-contain rounded-2xl shadow-xl bg-white p-2"
                  />
                </div>
                <h1 className="text-2xl font-bold text-white">Gest√£o Financeira Inteligente</h1>
                <p className="text-sm text-slate-200 mt-1 text-center px-4">
                  Finan√ßas claras, decis√µes inteligentes.
                </p>
                <p className="text-xs text-slate-300 mt-1 italic">
                  Desenvolvido para o Gordinho do Comfort
                </p>
              </div>

              <div className="bg-white rounded-2xl shadow-xl p-6">
                <div className="flex gap-2 mb-4">
                  <button
                    onClick={() => setAuthMode('login')}
                    className={`flex-1 py-2 rounded-xl text-sm font-medium transition ${authMode === 'login' ? 'bg-sky-600 text-white shadow' : 'bg-slate-100 text-slate-700 hover:bg-slate-200'}`}
                  >
                    Entrar
                  </button>
                  <button
                    onClick={() => setAuthMode('signup')}
                    className={`flex-1 py-2 rounded-xl text-sm font-medium transition ${authMode === 'signup' ? 'bg-sky-600 text-white shadow' : 'bg-slate-100 text-slate-700 hover:bg-slate-200'}`}
                  >
                    Cadastrar
                  </button>
                </div>

                <form onSubmit={handleAuth} className="space-y-4">
                  <div>
                    <label className="block text-xs font-semibold mb-1 text-slate-700">
                      E-mail
                    </label>
                    <input
                      type="email"
                      value={email}
                      onChange={(e) => setEmail(e.target.value)}
                      className="w-full border border-slate-200 rounded-xl px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500"
                      placeholder="seu@email.com"
                      required
                    />
                  </div>
                  <div>
                    <label className="block text-xs font-semibold mb-1 text-slate-700">
                      Senha
                    </label>
                    <input
                      type="password"
                      value={password}
                      onChange={(e) => setPassword(e.target.value)}
                      className="w-full border border-slate-200 rounded-xl px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500"
                      placeholder="m√≠nimo 6 caracteres"
                      required
                    />
                  </div>

                  {authError && (
                    <div className="bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded-lg text-xs">
                      {authError}
                    </div>
                  )}

                  <button
                    type="submit"
                    className="w-full bg-sky-600 hover:bg-sky-700 text-white py-2.5 rounded-xl font-semibold text-sm shadow-md transition"
                  >
                    {authMode === 'login' ? 'Entrar' : 'Criar Conta'}
                  </button>
                </form>
              </div>
            </div>
          </div>
        );
      }

      const allPlatforms = [...defaultPlatforms, ...customPlatforms.map(p => p.name), 'Outra'];

      return (
        <div className="min-h-screen flex flex-col bg-slate-50">
          <header className="bg-gradient-to-r from-slate-900 via-slate-800 to-sky-700 text-white p-4 shadow-lg">
            <div className="flex justify-between items-center max-w-xl mx-auto">
              <div>
                <h1 className="text-xl font-bold">üí∞ Gest√£o Financeira</h1>
                <p className="text-xs text-slate-200">{user.email}</p>
              </div>
              <button
                onClick={handleLogout}
                className="bg-white bg-opacity-20 hover:bg-opacity-30 px-3 py-1.5 rounded-lg text-sm transition"
              >
                Sair
              </button>
            </div>
          </header>

          <nav className="fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg flex justify-around py-2 text-xs sm:text-sm z-20">
            <button
              onClick={() => setActiveTab('dashboard')}
              className={`flex flex-col items-center px-3 py-1 ${activeTab === 'dashboard' ? 'text-sky-600 font-semibold' : 'text-gray-500'}`}
            >
              <span className="text-lg">üìä</span>
              <span>Dashboard</span>
            </button>
            <button
              onClick={() => setActiveTab('ganhos')}
              className={`flex flex-col items-center px-3 py-1 ${activeTab === 'ganhos' ? 'text-sky-600 font-semibold' : 'text-gray-500'}`}
            >
              <span className="text-lg">üíµ</span>
              <span>Ganhos</span>
            </button>
            <button
              onClick={() => setActiveTab('despesas-trabalho')}
              className={`flex flex-col items-center px-3 py-1 ${activeTab === 'despesas-trabalho' ? 'text-sky-600 font-semibold' : 'text-gray-500'}`}
            >
              <span className="text-lg">‚õΩ</span>
              <span>Trabalho</span>
            </button>
            <button
              onClick={() => setActiveTab('despesas-casa')}
              className={`flex flex-col items-center px-3 py-1 ${activeTab === 'despesas-casa' ? 'text-sky-600 font-semibold' : 'text-gray-500'}`}
            >
              <span className="text-lg">üè†</span>
              <span>Casa</span>
            </button>
          </nav>

          <main className="flex-1 p-3 pb-20 max-w-xl mx-auto w-full">
            {activeTab === 'dashboard' && (
              <div>
                <div className="flex justify-between items-center mb-3">
                  <select
                    value={filterPeriod}
                    onChange={(e) => setFilterPeriod(e.target.value)}
                    className="border border-slate-300 rounded-lg px-3 py-1.5 text-sm"
                  >
                    <option value="week">√öltima Semana</option>
                    <option value="month">M√™s Atual</option>
                    <option value="lastMonth">M√™s Passado</option>
                    <option value="year">Ano Atual</option>
                  </select>
                  <button
                    onClick={exportPDF}
                    className="bg-sky-600 hover:bg-sky-700 text-white text-sm px-4 py-1.5 rounded-lg shadow transition"
                  >
                    üìÑ Exportar PDF
                  </button>
                </div>

                <div className="bg-white rounded-xl p-4 shadow-lg mb-4">
                  <h3 className="font-bold text-slate-700 mb-3">üìÖ Compara√ß√£o Mensal</h3>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <div className="text-xs text-slate-500 mb-2 font-medium">M√™s Atual</div>
                      <div className="space-y-2">
                        <div>
                          <div className="text-xs text-slate-400">Receita</div>
                          <div className="text-lg font-bold text-emerald-600">R$ {currentMonthData.earnings.toFixed(2)}</div>
                        </div>
                        <div>
                          <div className="text-xs text-slate-400">Despesas</div>
                          <div className="text-lg font-bold text-amber-600">R$ {currentMonthData.expenses.toFixed(2)}</div>
                        </div>
                        <div>
                          <div className="text-xs text-slate-400">Lucro</div>
                          <div className="text-lg font-bold text-sky-600">R$ {currentMonthData.profit.toFixed(2)}</div>
                        </div>
                      </div>
                    </div>
                    <div>
                      <div className="text-xs text-slate-500 mb-2 font-medium">M√™s Passado</div>
                      <div className="space-y-2">
                        <div>
                          <div className="text-xs text-slate-400">Receita</div>
                          <div className="text-lg font-bold text-emerald-600">R$ {prevMonthData.earnings.toFixed(2)}</div>
                        </div>
                        <div>
                          <div className="text-xs text-slate-400">Despesas</div>
                          <div className="text-lg font-bold text-amber-600">R$ {prevMonthData.expenses.toFixed(2)}</div>
                        </div>
                        <div>
                          <div className="text-xs text-slate-400">Lucro</div>
                          <div className="text-lg font-bold text-sky-600">R$ {prevMonthData.profit.toFixed(2)}</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  {(earningsChange != 0 || profitChange != 0) && (
                    <div className="mt-3 pt-3 border-t border-slate-200">
                      <div className="flex justify-around text-xs">
                        {earningsChange != 0 && (
                          <div className={`${earningsChange > 0 ? 'text-emerald-600' : 'text-red-600'} font-medium`}>
                            Receita: {earningsChange > 0 ? '‚Üë' : '‚Üì'} {Math.abs(earningsChange)}%
                          </div>
                        )}
                        {profitChange != 0 && (
                          <div className={`${profitChange > 0 ? 'text-emerald-600' : 'text-red-600'} font-medium`}>
                            Lucro: {profitChange > 0 ? '‚Üë' : '‚Üì'} {Math.abs(profitChange)}%
                          </div>
                        )}
                      </div>
                    </div>
                  )}
                </div>

                <div className="grid grid-cols-2 gap-3 mb-4">
                  <div className="bg-gradient-to-br from-emerald-500 to-emerald-600 text-white rounded-xl p-4 shadow-lg">
                    <div className="text-xs opacity-90 font-medium">Receita</div>
                    <div className="text-2xl font-bold mt-1">R$ {totalEarnings.toFixed(2)}</div>
                  </div>
                  <div className="bg-gradient-to-br from-amber-500 to-amber-600 text-white rounded-xl p-4 shadow-lg">
                    <div className="text-xs opacity-90 font-medium">Despesas</div>
                    <div className="text-2xl font-bold mt-1">R$ {totalExpenses.toFixed(2)}</div>
                  </div>
                  <div className="bg-gradient-to-br from-sky-500 to-sky-600 text-white rounded-xl p-4 shadow-lg">
                    <div className="text-xs opacity-90 font-medium">Lucro</div>
                    <div className="text-2xl font-bold mt-1">R$ {workProfit.toFixed(2)}</div>
                  </div>
                  <div className="bg-gradient-to-br from-rose-500 to-rose-600 text-white rounded-xl p-4 shadow-lg">
                    <div className="text-xs opacity-90 font-medium">Casa</div>
                    <div className="text-2xl font-bold mt-1">R$ {totalHouseExpenses.toFixed(2)}</div>
                  </div>
                </div>

                <div className={`${finalBalance >= 0 ? 'bg-gradient-to-br from-teal-600 to-teal-700' : 'bg-gradient-to-br from-red-600 to-red-700'} text-white rounded-xl p-5 mb-4 shadow-lg`}>
                  <div className="text-sm opacity-90 font-medium">Saldo Final</div>
                  <div className="text-3xl font-bold mt-1">R$ {finalBalance.toFixed(2)}</div>
                </div>

                <div className="bg-white rounded-xl p-4 shadow-lg mb-4">
                  <h3 className="font-bold text-slate-700 mb-3">üìà Indicadores de Efici√™ncia</h3>
                  <div className="grid grid-cols-3 gap-3 text-center">
                    <div>
                      <div className="text-xs text-slate-500 mb-1">Ticket M√©dio</div>
                      <div className="text-lg font-bold text-sky-600">R$ {ticketMedio.toFixed(2)}</div>
                    </div>
                    <div>
                      <div className="text-xs text-slate-500 mb-1">Custo/Dia</div>
                      <div className="text-lg font-bold text-amber-600">R$ {custoPorDia.toFixed(2)}</div>
                    </div>
                    <div>
                      <div className="text-xs text-slate-500 mb-1">Margem</div>
                      <div className="text-lg font-bold text-emerald-600">{margemLucro.toFixed(1)}%</div>
                    </div>
                  </div>
                </div>

                <div className="bg-white rounded-xl p-4 shadow-lg mb-4">
                  <h3 className="font-bold text-slate-700 mb-3">
                    üìä Evolu√ß√£o {filterPeriod === 'month'
                      ? '(M√™s Atual)'
                      : filterPeriod === 'lastMonth'
                      ? '(M√™s Passado)'
                      : '(√öltimos 7 dias)'}
                  </h3>
                  <div style={{ height: '200px' }}>
                    <canvas ref={chartRef}></canvas>
                  </div>
                </div>

                <div className="bg-white rounded-xl p-4 shadow-lg">
                  <h3 className="font-bold text-slate-700 mb-3">üìä Indicadores</h3>
                  <div style={{ height: '200px' }}>
                    <canvas ref={barChartRef}></canvas>
                  </div>
                </div>
              </div>
            )}

            {activeTab === 'ganhos' && (
              <div>
                <div className="flex justify-between items-center mb-3">
                  <h2 className="text-lg font-bold text-slate-700">üíµ Ganhos</h2>
                  <button
                    onClick={() => setShowEarningModal(true)}
                    className="bg-emerald-600 hover:bg-emerald-700 text-white text-sm px-4 py-2 rounded-lg shadow transition"
                  >
                    + Ganho
                  </button>
                </div>

                {filteredEarnings.length === 0 && (
                  <p className="text-center text-slate-400 text-sm mt-6">
                    Nenhum ganho registrado
                  </p>
                )}

                {filteredEarnings.map(earning => (
                  <div key={earning.id} className="bg-white rounded-lg shadow p-4 mb-3">
                    <div className="flex justify-between items-center mb-1">
                      <div>
                        <span className="font-semibold text-slate-700">{earning.platform || 'Ganho'}</span>
                        <span className="text-xs text-slate-400 ml-2">{earning.date}</span>
                      </div>
                      <button
                        onClick={() => deleteEarning(earning.id)}
                        className="text-xs text-red-600 hover:text-red-700 font-medium"
                      >
                        Excluir
                      </button>
                    </div>
                    <div className="mt-2">
                      <span className="font-bold text-emerald-600 text-lg">R$ {earning.value.toFixed(2)}</span>
                    </div>
                  </div>
                ))}
              </div>
            )}

            {activeTab === 'despesas-trabalho' && (
              <div>
                <div className="flex justify-between items-center mb-3">
                  <h2 className="text-lg font-bold text-slate-700">‚õΩ Despesas Trabalho</h2>
                  <button
                    onClick={() => setShowExpenseModal(true)}
                    className="bg-amber-600 hover:bg-amber-700 text-white text-sm px-4 py-2 rounded-lg shadow transition"
                  >
                    + Despesa
                  </button>
                </div>

                {filteredExpenses.length === 0 && (
                  <p className="text-center text-slate-400 text-sm mt-6">
                    Nenhuma despesa registrado
                  </p>
                )}

                {filteredExpenses.map(expense => (
                  <div key={expense.id} className="bg-white rounded-lg shadow p-4 mb-3">
                    <div className="flex justify-between items-center mb-1">
                      <span className="font-semibold text-slate-700">{expense.category}</span>
                      <span className="text-xs text-slate-400">{expense.date}</span>
                    </div>
                    {expense.description && (
                      <div className="text-sm text-slate-500 mb-2">
                        {expense.description}
                      </div>
                    )}
                    <div className="flex justify-between items-center">
                      <span className="font-bold text-red-600 text-lg">R$ {expense.value.toFixed(2)}</span>
                      <button
                        onClick={() => deleteExpense(expense.id)}
                        className="text-xs text-red-600 hover:text-red-700 font-medium"
                      >
                        Excluir
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            )}

            {activeTab === 'despesas-casa' && (
              <div>
                <div className="flex justify-between items-center mb-3">
                  <h2 className="text-lg font-bold text-slate-700">üè† Despesas Casa</h2>
                  <button
                    onClick={() => setShowHouseModal(true)}
                    className="bg-rose-600 hover:bg-rose-700 text-white text-sm px-4 py-2 rounded-lg shadow transition"
                  >
                    + Despesa
                  </button>
                </div>

                {filteredHouseExpenses.length === 0 && (
                  <p className="text-center text-slate-400 text-sm mt-6">
                    Nenhuma despesa registrada
                  </p>
                )}

                {filteredHouseExpenses.map(house => (
                  <div key={house.id} className="bg-white rounded-lg shadow p-4 mb-3">
                    <div className="flex justify-between items-center mb-1">
                      <span className="font-semibold text-slate-700">{house.category}</span>
                      <span className="text-xs text-slate-400">{house.date}</span>
                    </div>
                    {house.description && (
                      <div className="text-sm text-slate-500 mb-2">
                        {house.description}
                      </div>
                    )}
                    <div className="flex justify-between items-center">
                      <span className="font-bold text-red-600 text-lg">R$ {house.value.toFixed(2)}</span>
                      <button
                        onClick={() => deleteHouseExpense(house.id)}
                        className="text-xs text-red-600 hover:text-red-700 font-medium"
                      >
                        Excluir
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </main>

          {showEarningModal && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-30">
              <div className="bg-white rounded-xl p-5 w-full max-w-sm shadow-2xl">
                <h3 className="text-lg font-bold mb-4 text-slate-700">üíµ Novo Ganho</h3>
                <div className="space-y-3 text-sm">
                  <div>
                    <label className="block mb-1 font-medium text-slate-600">Data</label>
                    <input
                      type="date"
                      value={earningForm.date}
                      onChange={e => setEarningForm({...earningForm, date: e.target.value})}
                      className="w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                    />
                  </div>
                  <div>
                    <label className="block mb-1 font-medium text-slate-600">Plataforma</label>
                    <select
                      value={earningForm.platform}
                      onChange={e => setEarningForm({...earningForm, platform: e.target.value})}
                      className="w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                    >
                      {allPlatforms.map(platform => (
                        <option key={platform} value={platform}>{platform}</option>
                      ))}
                    </select>
                  </div>
                  {earningForm.platform === 'Outra' && (
                    <div>
                      <label className="block mb-1 font-medium text-slate-600">Nome da Plataforma</label>
                      <input
                        type="text"
                        value={earningForm.customPlatform}
                        onChange={e => setEarningForm({...earningForm, customPlatform: e.target.value})}
                        className="w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                        placeholder="Ex: Cabify, Bolt, etc."
                      />
                    </div>
                  )}
                  <div>
                    <label className="block mb-1 font-medium text-slate-600">Valor (R$)</label>
                    <input
                      type="number"
                      step="0.01"
                      value={earningForm.value}
                      onChange={e => setEarningForm({...earningForm, value: e.target.value})}
                      className="w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                      placeholder="0,00"
                    />
                  </div>
                </div>
                <div className="flex gap-2 mt-5">
                  <button
                    onClick={() => {
                      setShowEarningModal(false);
                      setEarningForm({ date: today, platform: 'Uber', customPlatform: '', value: '' });
                    }}
                    className="flex-1 bg-slate-200 hover:bg-slate-300 text-slate-700 py-2.5 rounded-lg font-medium transition"
                  >
                    Cancelar
                  </button>
                  <button
                    onClick={addEarning}
                    className="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white py-2.5 rounded-lg font-medium transition"
                  >
                    Salvar
                  </button>
                </div>
              </div>
            </div>
          )}

          {showExpenseModal && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-30">
              <div className="bg-white rounded-xl p-5 w-full max-w-sm shadow-2xl">
                <h3 className="text-lg font-bold mb-4 text-slate-700">‚õΩ Nova Despesa Trabalho</h3>
                <div className="space-y-3 text-sm">
                  <div>
                    <label className="block mb-1 font-medium text-slate-600">Data</label>
                    <input
                      type="date"
                      value={expenseForm.date}
                      onChange={e => setExpenseForm({...expenseForm, date: e.target.value})}
                      className="w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-amber-500 focus:border-amber-500"
                    />
                  </div>
                  <div>
                    <label className="block mb-1 font-medium text-slate-600">Categoria</label>
                    <select
                      value={expenseForm.category}
                      onChange={e => setExpenseForm({...expenseForm, category: e.target.value})}
                      className="w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-amber-500 focus:border-amber-500"
                    >
                      <option>Combust√≠vel</option>
                      <option>Manuten√ß√£o</option>
                      <option>Lavagem</option>
                      <option>Ped√°gio</option>
                      <option>Estacionamento</option>
                      <option>√Ågua/Lanche</option>
                      <option>Outro</option>
                    </select>
                  </div>
                  <div>
                    <label className="block mb-1 font-medium text-slate-600">Descri√ß√£o</label>
                    <input
                      type="text"
                      value={expenseForm.description}
                      onChange={e => setExpenseForm({...expenseForm, description: e.target.value})}
                      className="w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-amber-500 focus:border-amber-500"
                      placeholder="Detalhes da despesa"
                    />
                  </div>
                  <div>
                    <label className="block mb-1 font-medium text-slate-600">Valor (R$)</label>
                    <input
                      type="number"
                      step="0.01"
                      value={expenseForm.value}
                      onChange={e => setExpenseForm({...expenseForm, value: e.target.value})}
                      className="w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-amber-500 focus:border-amber-500"
                      placeholder="0,00"
                    />
                  </div>
                </div>
                <div className="flex gap-2 mt-5">
                  <button
                    onClick={() => {
                      setShowExpenseModal(false);
                      setExpenseForm({ date: today, category: 'Combust√≠vel', description: '', value: '' });
                    }}
                    className="flex-1 bg-slate-200 hover:bg-slate-300 text-slate-700 py-2.5 rounded-lg font-medium transition"
                  >
                    Cancelar
                  </button>
                  <button
                    onClick={addExpense}
                    className="flex-1 bg-amber-600 hover:bg-amber-700 text-white py-2.5 rounded-lg font-medium transition"
                  >
                    Salvar
                  </button>
                </div>
              </div>
            </div>
          )}

          {showHouseModal && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-30">
              <div className="bg-white rounded-xl p-5 w-full max-w-sm shadow-2xl">
                <h3 className="text-lg font-bold mb-4 text-slate-700">üè† Nova Despesa Casa</h3>
                <div className="space-y-3 text-sm">
                  <div>
                    <label className="block mb-1 font-medium text-slate-600">Data</label>
                    <input
                      type="date"
                      value={houseForm.date}
                      onChange={e => setHouseForm({...houseForm, date: e.target.value})}
                      className="w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-rose-500 focus:border-rose-500"
                    />
                  </div>
                  <div>
                    <label className="block mb-1 font-medium text-slate-600">Categoria</label>
                    <select
                      value={houseForm.category}
                      onChange={e => setHouseForm({...houseForm, category: e.target.value})}
                      className="w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-rose-500 focus:border-rose-500"
                    >
                      <option>Alimenta√ß√£o</option>
                      <option>Aluguel</option>
                      <option>√Ågua</option>
                      <option>Luz</option>
                      <option>Internet</option>
                      <option>Telefone</option>
                      <option>Outro</option>
                    </select>
                  </div>
                  <div>
                    <label className="block mb-1 font-medium text-slate-600">Descri√ß√£o</label>
                    <input
                      type="text"
                      value={houseForm.description}
                      onChange={e => setHouseForm({...houseForm, description: e.target.value})}
                      className="w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-rose-500 focus:border-rose-500"
                      placeholder="Detalhes da despesa"
                    />
                  </div>
                  <div>
                    <label className="block mb-1 font-medium text-slate-600">Valor (R$)</label>
                    <input
                      type="number"
                      step="0.01"
                      value={houseForm.value}
                      onChange={e => setHouseForm({...houseForm, value: e.target.value})}
                      className="w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-rose-500 focus:border-rose-500"
                      placeholder="0,00"
                    />
                  </div>
                </div>
                <div className="flex gap-2 mt-5">
                  <button
                    onClick={() => {
                      setShowHouseModal(false);
                      setHouseForm({ date: today, category: 'Alimenta√ß√£o', description: '', value: '' });
                    }}
                    className="flex-1 bg-slate-200 hover:bg-slate-300 text-slate-700 py-2.5 rounded-lg font-medium transition"
                  >
                    Cancelar
                  </button>
                  <button
                    onClick={addHouseExpense}
                    className="flex-1 bg-rose-600 hover:bg-rose-700 text-white py-2.5 rounded-lg font-medium transition"
                  >
                    Salvar
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
